---
Title: 1人でISUCON2
Category:
- その他
Date: 2013-09-27T22:06:49+09:00
URL: https://krrrr.hatenablog.com/entry/2013/09/27/220649
EditURL: https://blog.hatena.ne.jp/krrrr/krrrr.hatenablog.com/atom/entry/11696248318758165354
---

** たのしいISUCON
[http://blog.nomadscafe.jp/2013/08/isucon.html:title]やら[http://blog.livedoor.jp/techblog/archives/67728751.html:title]を参考にAWSに環境構築して1人でイイ感じにしようと試みた

上に書いてるAMIは（見つから）無くて，一から作る感じ
なんとなくで適当に入れてったらなんとなく出来た

前から興味あったし非常に楽しめた

** 結果
[f:id:krrrr:20130927214048p:plain]
1番左が何もしてない状態で右へ順々に．116,000あたりが最後のBESTだった気がする伸び悩んだ

優勝者はこの2倍以上の結果出してるってどこかで見たしすごい

perl使った
- nginx
-- 静的ファイルはnginxで返す
- Starlet
-- worker数やら調整
- mysqlのテーブルに適当なindex貼る
-- ログ抑えたりinnodb_buffer_pool_size調整
- GETリクエスト
-- 良い感じにキャッシュ

大体これだけで4000ticketsぐらいいく気がする

** 反省
計測系もっとちゃんと使いこなしたかった
- nginx
-- upsttime:$upstream_response_time
- http_load
-- なんとなく使えた
- Devel::NYTProf
-- 1回だけ -MDevel::NYTProfしてnytprofhtmlしてhtml見た
-- その辺のライブラリに対しての結果も出てきて見方よく分からんかった
- Devel::KYTProf
-- psgiにはどうやって使うのが良かったんだろう
-- uaで各パスに対してリクエスト投げる関数作ってそれら評価したら良かった
- mysql
-- slow queryログ出なかったなぜに
- dstat
-- ？？？？？

/buyのPOSTをmemcached使って良い感じにしたかったけど値が若干ずれたりでダメダメだった．
実際に超ユーザ数多いサイトとかだとこんな感じになるだろうし作ってる人はすごい

nginxで静的ファイルは返すとして，Starlet使うかStarman使うかでちょこちょこ触ってたけどStarlet+HTTP/1.0の方がスコア良い感じだった

** 備考
なんとなくでやってしまったの多いから何も参考にならないエントリだ
来月頭にISUCON3の予選あるみたいだけど友達いないし出れない...学生枠...
