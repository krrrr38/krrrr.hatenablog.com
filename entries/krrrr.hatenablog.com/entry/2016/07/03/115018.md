---
Title: BeanValidationのmessage変数を更に翻訳したい
Category:
- Java
- Spring
Date: 2016-07-03T11:50:18+09:00
URL: https://krrrr.hatenablog.com/entry/2016/07/03/115018
EditURL: https://blog.hatena.ne.jp/krrrr/krrrr.hatenablog.com/atom/entry/6653812171403745190
---

BeanValidationでConstraintValidatorとか使ってて、独自Validatorでmessageに埋め込む変数も良い感じに翻訳したいなと思った次第

元々`@Size`にはmessageとして、以下のようなものが割り当ててられており、`{min}`などには渡したパラメータが埋められる。
```
javax.validation.constraints.Size.message=size must be between {min} and {max}
```

もちろん独自のValidatorを作った際にも利用出来て、ELとかも書ける。

<!-- more -->

初めはSpringのMessageSourceの一部メソッドをoverrideしようと思ったけど、beanvalidationの変数埋め込みの方がMessageSourceより後に走るので上手く出来なかった。
Vaidatorを眺めてると、以下のドキュメントにもあるように`MessageInterpolator`で良い感じにhookする所があった。ので、ただそこに翻訳処理を仕込むだけ。

[http://beanvalidation.org/1.1/spec/#validationapi-message:title]

[https://gist.github.com/3ef6eb6a6d5803bfbb7b8caf15282584:embed#gist3ef6eb6a6d5803bfbb7b8caf15282584]

利用側

```java
@Constraint(validatedBy = MySizeLongValidator.class )
public @interface MySizeLong {
    String message() default "{my.validation.size.long}";
    int max() default Integer.MAX_VALUE;
    String field() default "field";
}
```

```java
public class Form {
    @MySizeLong(max = 10, field = "{form.str.name}")
    private String str;
}
```

```
my.validation.size.long={field} is too long
form.str.name=str_en_name
```

以下のように変換される

1. `{my.validation.size.long}`: MySizeLong.message
1. `{field} is too long`: MessageSource.getMessage
1. `{form.str.name} is too long`: ResourceBundleMessageInterpolator.interpolate
1. `str_en_name is too long`: ReTransableMessageInterpolator.interpolate

EL? 知らない子ですね
