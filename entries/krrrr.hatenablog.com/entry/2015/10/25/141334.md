---
Title: Refresh Cache in background
Category:
- Java
Date: 2015-10-25T14:13:34+09:00
URL: https://krrrr.hatenablog.com/entry/2015/10/25/141334
EditURL: https://blog.hatena.ne.jp/krrrr/krrrr.hatenablog.com/atom/entry/6653458415125787306
---

- 処理に時間のかかるものをキャッシュ
- キャッシュするためのkeyが不定だが、偏りがある
- 初回取得時もすぐにデータを取りたい
  - warmup
  - (いきなりkeyが不定の条件から外れてるが、これは仕方ない...)
- expireした時もすぐにデータを取りたい
  - 非同期で呼ばれるであろうkeyに対してキャッシュを予め更新しておく
- メモリリークしたくない
  - 更新間でどんなkeyが来たのかを貯めておいて、それのみ更新の対象にする
  - 不要になったデータはGC対象に
<!-- more -->


[https://gist.github.com/030e8ce26d41f2488d50:embed#with Spring]

[with Spring](https://gist.github.com/030e8ce26d41f2488d50)

expireAfterWrite/refreshAfterWriteしても、次回読み込み時はload処理が走ってそのリクエストを返すのが遅くなるし、定期的に更新するかという気持ち

Springなら [@Scheduled](http://docs.spring.io/spring/docs/current/spring-framework-reference/html/scheduling.html#scheduling-annotation-support-scheduled) とか使う方が良いけど、それ以外なら適当にExecutor回す
